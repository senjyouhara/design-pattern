<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>解释器模式 | JAVA设计模式</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="JAVA设计模式">
    
    <link rel="preload" href="/design-pattern/assets/css/0.styles.5341db10.css" as="style"><link rel="preload" href="/design-pattern/assets/js/app.45f4ed8b.js" as="script"><link rel="preload" href="/design-pattern/assets/js/2.dd66b6b4.js" as="script"><link rel="preload" href="/design-pattern/assets/js/29.89b373e8.js" as="script"><link rel="prefetch" href="/design-pattern/assets/js/10.e7bcc2af.js"><link rel="prefetch" href="/design-pattern/assets/js/11.a7e17509.js"><link rel="prefetch" href="/design-pattern/assets/js/12.5deb2685.js"><link rel="prefetch" href="/design-pattern/assets/js/13.8387bba7.js"><link rel="prefetch" href="/design-pattern/assets/js/14.6c42d1b1.js"><link rel="prefetch" href="/design-pattern/assets/js/15.3cb5bbbe.js"><link rel="prefetch" href="/design-pattern/assets/js/16.e60f62c7.js"><link rel="prefetch" href="/design-pattern/assets/js/17.f4ca0f28.js"><link rel="prefetch" href="/design-pattern/assets/js/18.be2874bb.js"><link rel="prefetch" href="/design-pattern/assets/js/19.98f55331.js"><link rel="prefetch" href="/design-pattern/assets/js/20.693bdd6c.js"><link rel="prefetch" href="/design-pattern/assets/js/21.cd7cac49.js"><link rel="prefetch" href="/design-pattern/assets/js/22.afafc6f9.js"><link rel="prefetch" href="/design-pattern/assets/js/23.f5f36a02.js"><link rel="prefetch" href="/design-pattern/assets/js/24.2761ed7d.js"><link rel="prefetch" href="/design-pattern/assets/js/25.73a46f0c.js"><link rel="prefetch" href="/design-pattern/assets/js/26.6afae513.js"><link rel="prefetch" href="/design-pattern/assets/js/27.9e44b99e.js"><link rel="prefetch" href="/design-pattern/assets/js/28.888ee2c2.js"><link rel="prefetch" href="/design-pattern/assets/js/3.704ac8ee.js"><link rel="prefetch" href="/design-pattern/assets/js/30.c1e53709.js"><link rel="prefetch" href="/design-pattern/assets/js/31.a53c8f9e.js"><link rel="prefetch" href="/design-pattern/assets/js/32.cd9a54d0.js"><link rel="prefetch" href="/design-pattern/assets/js/33.3efcfa5b.js"><link rel="prefetch" href="/design-pattern/assets/js/34.5bad324b.js"><link rel="prefetch" href="/design-pattern/assets/js/35.2f4dac27.js"><link rel="prefetch" href="/design-pattern/assets/js/36.06a6c412.js"><link rel="prefetch" href="/design-pattern/assets/js/37.139a7bc2.js"><link rel="prefetch" href="/design-pattern/assets/js/38.349560b7.js"><link rel="prefetch" href="/design-pattern/assets/js/39.1462d1dd.js"><link rel="prefetch" href="/design-pattern/assets/js/4.81f7c0d7.js"><link rel="prefetch" href="/design-pattern/assets/js/40.cc7739ed.js"><link rel="prefetch" href="/design-pattern/assets/js/41.30b4b76c.js"><link rel="prefetch" href="/design-pattern/assets/js/42.d4f9a883.js"><link rel="prefetch" href="/design-pattern/assets/js/43.3c75efc8.js"><link rel="prefetch" href="/design-pattern/assets/js/44.254cfecb.js"><link rel="prefetch" href="/design-pattern/assets/js/45.f970681e.js"><link rel="prefetch" href="/design-pattern/assets/js/46.2b6dc672.js"><link rel="prefetch" href="/design-pattern/assets/js/47.51bcccb8.js"><link rel="prefetch" href="/design-pattern/assets/js/48.a9a64665.js"><link rel="prefetch" href="/design-pattern/assets/js/49.56e52fda.js"><link rel="prefetch" href="/design-pattern/assets/js/5.d43c6033.js"><link rel="prefetch" href="/design-pattern/assets/js/50.024ee7ff.js"><link rel="prefetch" href="/design-pattern/assets/js/51.e23e7e1b.js"><link rel="prefetch" href="/design-pattern/assets/js/52.ddc4950d.js"><link rel="prefetch" href="/design-pattern/assets/js/53.56beec5d.js"><link rel="prefetch" href="/design-pattern/assets/js/54.cbec228c.js"><link rel="prefetch" href="/design-pattern/assets/js/6.686b6a92.js"><link rel="prefetch" href="/design-pattern/assets/js/7.1103645d.js"><link rel="prefetch" href="/design-pattern/assets/js/8.4dcd5424.js"><link rel="prefetch" href="/design-pattern/assets/js/9.01bd6308.js">
    <link rel="stylesheet" href="/design-pattern/assets/css/0.styles.5341db10.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/design-pattern/" class="home-link router-link-active"><!----> <span class="site-name">JAVA设计模式</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/design-pattern/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/senjyouhara/design-pattern" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/design-pattern/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/senjyouhara/design-pattern" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>设计模式</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/design-pattern/设计模式/0.0-概述.html" class="sidebar-link">软件设计模式概述</a></li><li><a href="/design-pattern/设计模式/0.1-GoF 的 23 种设计模式的分类和功能.html" class="sidebar-link">GoF 的 23 种设计模式的分类和功能</a></li><li><a href="/design-pattern/设计模式/0.2-UML统一建模语言是什么？.html" class="sidebar-link">UML统一建模语言是什么？</a></li><li><a href="/design-pattern/设计模式/0.3-UML类图及类图之间的关系.html" class="sidebar-link">UML类图及类图之间的关系</a></li><li><a href="/design-pattern/设计模式/0.4-类关系记忆技巧.html" class="sidebar-link">类关系记忆技巧</a></li><li><a href="/design-pattern/设计模式/0.5-UMLet的使用与类图的设计.html" class="sidebar-link">UMLet的使用与类图的设计</a></li><li><a href="/design-pattern/设计模式/0.6-什么才是优秀的软件架构？.html" class="sidebar-link">什么才是优秀的软件架构？</a></li><li><a href="/design-pattern/设计模式/0.7-如何正确使用设计模式？.html" class="sidebar-link">如何正确使用设计模式？</a></li><li><a href="/design-pattern/设计模式/01-开闭原则——面向对象设计原则.html" class="sidebar-link">开闭原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/02-里氏替换原则——面向对象设计原则.html" class="sidebar-link">里氏替换原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/03-依赖倒置原则——面向对象设计原则.html" class="sidebar-link">依赖倒置原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/04-单一职责原则——面向对象设计原则.html" class="sidebar-link">单一职责原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/05-接口隔离原则——面向对象设计原则.html" class="sidebar-link">接口隔离原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/06-迪米特法则——面向对象设计原则.html" class="sidebar-link">迪米特法则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/07-合成复用原则——面向对象设计原则.html" class="sidebar-link">合成复用原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/08-一句话总结软件设计七大原则.html" class="sidebar-link">一句话总结软件设计七大原则</a></li><li><a href="/design-pattern/设计模式/09-创建型模式的特点和分类.html" class="sidebar-link">创建型模式的特点和分类</a></li><li><a href="/design-pattern/设计模式/10-单例模式.html" class="sidebar-link">单例模式</a></li><li><a href="/design-pattern/设计模式/11-原型模式.html" class="sidebar-link">原型模式</a></li><li><a href="/design-pattern/设计模式/12-简单工厂模式.html" class="sidebar-link">简单工厂模式</a></li><li><a href="/design-pattern/设计模式/13-工厂方法模式.html" class="sidebar-link">工厂方法模式</a></li><li><a href="/design-pattern/设计模式/14-抽象工厂模式.html" class="sidebar-link">抽象工厂模式</a></li><li><a href="/design-pattern/设计模式/15-建造者模式.html" class="sidebar-link">建造者模式</a></li><li><a href="/design-pattern/设计模式/16-创建型模式应用实验.html" class="sidebar-link">创建型模式应用实验</a></li><li><a href="/design-pattern/设计模式/17-结构型模式概述.html" class="sidebar-link">结构型模式概述</a></li><li><a href="/design-pattern/设计模式/18-代理模式.html" class="sidebar-link">代理模式</a></li><li><a href="/design-pattern/设计模式/19-适配器模式.html" class="sidebar-link">适配器模式</a></li><li><a href="/design-pattern/设计模式/20-桥接模式.html" class="sidebar-link">桥接模式</a></li><li><a href="/design-pattern/设计模式/21-装饰器模式.html" class="sidebar-link">装饰器模式</a></li><li><a href="/design-pattern/设计模式/22-外观模式.html" class="sidebar-link">外观模式</a></li><li><a href="/design-pattern/设计模式/23-享元模式.html" class="sidebar-link">享元模式</a></li><li><a href="/design-pattern/设计模式/24-组合模式.html" class="sidebar-link">组合模式</a></li><li><a href="/design-pattern/设计模式/25-结构型模式应用实验.html" class="sidebar-link">结构型模式应用实验</a></li><li><a href="/design-pattern/设计模式/26-行为型模式概述.html" class="sidebar-link">行为型模式概述</a></li><li><a href="/design-pattern/设计模式/27-模板方法模式.html" class="sidebar-link">模板方法模式</a></li><li><a href="/design-pattern/设计模式/28-策略模式.html" class="sidebar-link">策略模式</a></li><li><a href="/design-pattern/设计模式/29-命令模式.html" class="sidebar-link">命令模式</a></li><li><a href="/design-pattern/设计模式/30-责任链模式.html" class="sidebar-link">责任链模式</a></li><li><a href="/design-pattern/设计模式/31-状态模式.html" class="sidebar-link">状态模式</a></li><li><a href="/design-pattern/设计模式/32-观察者模式.html" class="sidebar-link">观察者模式</a></li><li><a href="/design-pattern/设计模式/33-中介者模式.html" class="sidebar-link">中介者模式</a></li><li><a href="/design-pattern/设计模式/34-迭代器模式.html" class="sidebar-link">迭代器模式</a></li><li><a href="/design-pattern/设计模式/35-访问者模式.html" class="sidebar-link">访问者模式</a></li><li><a href="/design-pattern/设计模式/36-备忘录模式.html" class="sidebar-link">备忘录模式</a></li><li><a href="/design-pattern/设计模式/37-解释器模式.html" class="active sidebar-link">解释器模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design-pattern/设计模式/37-解释器模式.html#解释器模式" class="sidebar-link">解释器模式</a></li></ul></li><li><a href="/design-pattern/设计模式/38-行为型模式应用实验.html" class="sidebar-link">行为型模式应用实验</a></li><li><a href="/design-pattern/设计模式/39-一句话归纳设计模式.html" class="sidebar-link">一句话归纳设计模式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="解释器模式"><a href="#解释器模式" class="header-anchor">#</a> 解释器模式</h2> <p>在软件开发中，会遇到有些问题多次重复出现，而且有一定的相似性和规律性。如果将它们归纳成一种简单的语言，那么这些问题实例将是该语言的一些句子，这样就可以用“编译原理”中的解释器模式来实现了。</p> <p>虽然使用解释器模式的实例不是很多，但对于满足以上特点，且对运行效率要求不是很高的应用实例，如果用解释器模式来实现，其效果是非常好的，本文将介绍其工作原理与使用方法。</p> <h3 id="模式的定义与特点"><a href="#模式的定义与特点" class="header-anchor">#</a> 模式的定义与特点</h3> <p>解释器（Interpreter）模式的定义：给分析对象定义一个语言，并定义该语言的文法表示，再设计一个解析器来解释语言中的句子。也就是说，用编译语言的方式来分析应用中的实例。这种模式实现了文法表达式处理的接口，该接口解释一个特定的上下文。</p> <p>这里提到的文法和句子的概念同编译原理中的描述相同，“文法”指语言的语法规则，而“句子”是语言集中的元素。例如，汉语中的句子有很多，“我是中国人”是其中的一个句子，可以用一棵语法树来直观地描述语言中的句子。</p> <p>解释器模式是一种类行为型模式，其主要优点如下。</p> <ul><li>扩展性好。由于在解释器模式中使用类来表示语言的文法规则，因此可以通过继承等机制来改变或扩展文法。</li> <li>容易实现。在语法树中的每个表达式节点类都是相似的，所以实现其文法较为容易。</li></ul> <p>解释器模式的主要缺点如下。</p> <ul><li>执行效率较低。解释器模式中通常使用大量的循环和递归调用，当要解释的句子较复杂时，其运行速度很慢，且代码的调试过程也比较麻烦。</li> <li>会引起类膨胀。解释器模式中的每条规则至少需要定义一个类，当包含的文法规则很多时，类的个数将急剧增加，导致系统难以管理与维护。</li> <li>可应用的场景比较少。在软件开发中，需要定义语言文法的应用实例非常少，所以这种模式很少被使用到。</li></ul> <h3 id="模式的结构与实现"><a href="#模式的结构与实现" class="header-anchor">#</a> 模式的结构与实现</h3> <p>解释器模式常用于对简单语言的编译或分析实例中，为了掌握好它的结构与实现，必须先了解编译原理中的“文法、句子、语法树”等相关概念。</p> <h5 id="_1-文法"><a href="#_1-文法" class="header-anchor">#</a> 1) 文法</h5> <p>文法是用于描述语言的语法结构的形式规则。没有规矩不成方圆，例如，有些人认为完美爱情的准则是“相互吸引、感情专一、任何一方都没有恋爱经历”，虽然最后一条准则较苛刻，但任何事情都要有规则，语言也一样，不管它是机器语言还是自然语言，都有它自己的文法规则。例如，中文中的“句子”的文法如下。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>〈句子〉::=〈主语〉〈谓语〉〈宾语〉
〈主语〉::=〈代词〉|〈名词〉
〈谓语〉::=〈动词〉
〈宾语〉::=〈代词〉|〈名词〉
〈代词〉你|我|他
〈名词〉7大学生I筱霞I英语
〈动词〉::=是|学习
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>注：这里的符号“::=”表示“定义为”的意思，用“〈”和“〉”括住的是非终结符，没有括住的是终结符。</p> <h5 id="_2-句子"><a href="#_2-句子" class="header-anchor">#</a> 2) 句子</h5> <p>句子是语言的基本单位，是语言集中的一个元素，它由终结符构成，能由“文法”推导出。例如，上述文法可以推出“我是大学生”，所以它是句子。</p> <h5 id="_3-语法树"><a href="#_3-语法树" class="header-anchor">#</a> 3) 语法树</h5> <p>语法树是句子结构的一种树型表示，它代表了句子的推导结果，它有利于理解句子语法结构的层次。图 1 所示是“我是大学生”的语法树。</p> <p><img src="data:image/gif;base64,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" alt=""></p> <p>有了以上基础知识，现在来介绍解释器模式的结构就简单了。解释器模式的结构与组合模式相似，不过其包含的组成元素比组合模式多，而且组合模式是对象结构型模式，而解释器模式是类行为型模式。</p> <h5 id="_1-模式的结构"><a href="#_1-模式的结构" class="header-anchor">#</a> 1. 模式的结构</h5> <p>解释器模式包含以下主要角色。</p> <ul><li>抽象表达式（Abstract Expression）角色：定义解释器的接口，约定解释器的解释操作，主要包含解释方法 interpret()。</li> <li>终结符表达式（Terminal Expression）角色：是抽象表达式的子类，用来实现文法中与终结符相关的操作，文法中的每一个终结符都有一个具体终结表达式与之相对应。</li> <li>非终结符表达式（Nonterminal Expression）角色：也是抽象表达式的子类，用来实现文法中与非终结符相关的操作，文法中的每条规则都对应于一个非终结符表达式。</li> <li>环境（Context）角色：通常包含各个解释器需要的数据或是公共的功能，一般用来传递被所有解释器共享的数据，后面的解释器可以从这里获取这些值。</li> <li>客户端（Client）：主要任务是将需要分析的句子或表达式转换成使用解释器对象描述的抽象语法树，然后调用解释器的解释方法，当然也可以通过环境角色间接访问解释器的解释方法。</li></ul> <p>解释器模式的结构图如图所示。</p> <p><img src="/design-pattern/assets/img/3-1Q119150626422.ef3294c0.gif" alt=""></p> <h5 id="_2-模式的实现"><a href="#_2-模式的实现" class="header-anchor">#</a> 2. 模式的实现</h5> <p>解释器模式实现的关键是定义文法规则、设计终结符类与非终结符类、画出结构图，必要时构建语法树，其代码结构如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">net<span class="token punctuation">.</span>biancheng<span class="token punctuation">.</span>c<span class="token punctuation">.</span>interpreter</span><span class="token punctuation">;</span>
<span class="token comment">//抽象表达式类</span>
<span class="token keyword">interface</span> <span class="token class-name">AbstractExpression</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token class-name">String</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//解释方法</span>
<span class="token punctuation">}</span>
<span class="token comment">//终结符表达式类</span>
<span class="token keyword">class</span> <span class="token class-name">TerminalExpression</span> <span class="token keyword">implements</span> <span class="token class-name">AbstractExpression</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token class-name">String</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//对终结符表达式的处理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//非终结符表达式类</span>
<span class="token keyword">class</span> <span class="token class-name">NonterminalExpression</span> <span class="token keyword">implements</span> <span class="token class-name">AbstractExpression</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">AbstractExpression</span> exp1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">AbstractExpression</span> exp2<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token class-name">String</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//非对终结符表达式的处理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//环境类</span>
<span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">AbstractExpression</span> exp<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//数据初始化</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token class-name">String</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//调用相关表达式类的解释方法</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="模式的应用实例"><a href="#模式的应用实例" class="header-anchor">#</a> 模式的应用实例</h3> <p>【例1】用解释器模式设计一个“韶粵通”公交车卡的读卡器程序。</p> <p>说明：假如“韶粵通”公交车读卡器可以判断乘客的身份，如果是“韶关”或者“广州”的“老人” “妇女”“儿童”就可以免费乘车，其他人员乘车一次扣 2 元。</p> <p>分析：本实例用“解释器模式”设计比较适合，首先设计其文法规则如下。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;expression&gt; ::= &lt;city&gt;的&lt;person&gt;
&lt;city&gt; ::= 韶关|广州
&lt;person&gt; ::= 老人|妇女|儿童
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后，根据文法规则按以下步骤设计公交车卡的读卡器程序的类图。</p> <ul><li>定义一个抽象表达式（Expression）接口，它包含了解释方法 interpret(String info)。</li> <li>定义一个终结符表达式（Terminal Expression）类，它用集合（Set）类来保存满足条件的城市或人，并实现抽象表达式接口中的解释方法 interpret(Stringinfo)，用来判断被分析的字符串是否是集合中的终结符。</li> <li>定义一个非终结符表达式（AndExpressicm）类，它也是抽象表达式的子类，它包含满足条件的城市的终结符表达式对象和满足条件的人员的终结符表达式对象，并实现 interpret(String info) 方法，用来判断被分析的字符串是否是满足条件的城市中的满足条件的人员。</li> <li>最后，定义一个环境（Context）类，它包含解释器需要的数据，完成对终结符表达式的初始化，并定义一个方法 freeRide(String info) 调用表达式对象的解释方法来对被分析的字符串进行解释。其结构图如图所示。</li></ul> <p><img src="/design-pattern/assets/img/3-1Q119150Q6401.aac83beb.gif" alt=""></p> <p>程序代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">net<span class="token punctuation">.</span>biancheng<span class="token punctuation">.</span>c<span class="token punctuation">.</span>interpreter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token comment">/*文法规则
  &lt;expression&gt; ::= &lt;city&gt;的&lt;person&gt;
  &lt;city&gt; ::= 韶关|广州
  &lt;person&gt; ::= 老人|妇女|儿童
*/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterpreterPatternDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bus<span class="token punctuation">.</span><span class="token function">freeRide</span><span class="token punctuation">(</span><span class="token string">&quot;韶关的老人&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bus<span class="token punctuation">.</span><span class="token function">freeRide</span><span class="token punctuation">(</span><span class="token string">&quot;韶关的年轻人&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bus<span class="token punctuation">.</span><span class="token function">freeRide</span><span class="token punctuation">(</span><span class="token string">&quot;广州的妇女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bus<span class="token punctuation">.</span><span class="token function">freeRide</span><span class="token punctuation">(</span><span class="token string">&quot;广州的儿童&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bus<span class="token punctuation">.</span><span class="token function">freeRide</span><span class="token punctuation">(</span><span class="token string">&quot;山东的儿童&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//抽象表达式类</span>
<span class="token keyword">interface</span> <span class="token class-name">Expression</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token class-name">String</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//终结符表达式类</span>
<span class="token keyword">class</span> <span class="token class-name">TerminalExpression</span> <span class="token keyword">implements</span> <span class="token class-name">Expression</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">TerminalExpression</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token class-name">String</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//非终结符表达式类</span>
<span class="token keyword">class</span> <span class="token class-name">AndExpression</span> <span class="token keyword">implements</span> <span class="token class-name">Expression</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Expression</span> city <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Expression</span> person <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">AndExpression</span><span class="token punctuation">(</span><span class="token class-name">Expression</span> city<span class="token punctuation">,</span> <span class="token class-name">Expression</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> city<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>person <span class="token operator">=</span> person<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">interpret</span><span class="token punctuation">(</span><span class="token class-name">String</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;的&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> city<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> person<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//环境类</span>
<span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> citys <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;韶关&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;广州&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> persons <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;老人&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;妇女&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;儿童&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Expression</span> cityPerson<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Expression</span> city <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TerminalExpression</span><span class="token punctuation">(</span>citys<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Expression</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TerminalExpression</span><span class="token punctuation">(</span>persons<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cityPerson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AndExpression</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span> person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">freeRide</span><span class="token punctuation">(</span><span class="token class-name">String</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> ok <span class="token operator">=</span> cityPerson<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;您是&quot;</span> <span class="token operator">+</span> info <span class="token operator">+</span> <span class="token string">&quot;，您本次乘车免费！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info <span class="token operator">+</span> <span class="token string">&quot;，您不是免费人员，本次乘车扣费2元！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>程序运行结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>您是韶关的老人，您本次乘车免费！
韶关的年轻人，您不是免费人员，本次乘车扣费2元！
您是广州的妇女，您本次乘车免费！
您是广州的儿童，您本次乘车免费！
山东的儿童，您不是免费人员，本次乘车扣费2元！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="模式的应用场景"><a href="#模式的应用场景" class="header-anchor">#</a> 模式的应用场景</h3> <p>前面介绍了解释器模式的结构与特点，下面分析它的应用场景。</p> <ul><li>当语言的文法较为简单，且执行效率不是关键问题时。</li> <li>当问题重复出现，且可以用一种简单的语言来进行表达时。</li> <li>当一个语言需要解释执行，并且语言中的句子可以表示为一个抽象语法树的时候，如 XML 文档解释。</li></ul> <p>注意：解释器模式在实际的软件开发中使用比较少，因为它会引起效率、性能以及维护等问题。如果碰到对表达式的解释，在 Java 中可以用 Expression4J 或 Jep 等来设计。</p> <h3 id="模式的扩展"><a href="#模式的扩展" class="header-anchor">#</a> 模式的扩展</h3> <p>在项目开发中，如果要对数据表达式进行分析与计算，无须再用解释器模式进行设计了，Java 提供了以下强大的数学公式解析器：Expression4J、MESP(Math Expression String Parser) 和 Jep 等，它们可以解释一些复杂的文法，功能强大，使用简单。</p> <p>现在以 Jep 为例来介绍该工具包的使用方法。Jep 是 Java expression parser 的简称，即 Java 表达式分析器，它是一个用来转换和计算数学表达式的 Java 库。通过这个程序库，用户可以以字符串的形式输入一个任意的公式，然后快速地计算出其结果。而且 Jep 支持用户自定义变量、常量和函数，它包括许多常用的数学函数和常量。</p> <p>使用前先下载 Jep 压缩包，解压后，将 jep-x.x.x.jar 文件移到选择的目录中，在 Eclipse 的“Java 构建路径”对话框的“库”选项卡中选择“添加外部 JAR(X)...”，将该 Jep 包添加项目中后即可使用其中的类库。</p> <p>下面以计算存款利息为例来介绍。存款利息的计算公式是：本金x利率x时间=利息，其相关代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">net<span class="token punctuation">.</span>biancheng<span class="token punctuation">.</span>c<span class="token punctuation">.</span>interpreter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>singularsys<span class="token punctuation">.</span>jep<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JepDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JepException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Jep</span> jep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//定义要计算的数据表达式</span>
        <span class="token class-name">String</span> 存款利息 <span class="token operator">=</span> <span class="token string">&quot;本金*利率*时间&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//给相关变量赋值</span>
        jep<span class="token punctuation">.</span><span class="token function">addVariable</span><span class="token punctuation">(</span><span class="token string">&quot;本金&quot;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jep<span class="token punctuation">.</span><span class="token function">addVariable</span><span class="token punctuation">(</span><span class="token string">&quot;利率&quot;</span><span class="token punctuation">,</span> <span class="token number">0.038</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jep<span class="token punctuation">.</span><span class="token function">addVariable</span><span class="token punctuation">(</span><span class="token string">&quot;时间&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jep<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>存款利息<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//解析表达式</span>
        <span class="token class-name">Object</span> accrual <span class="token operator">=</span> jep<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//计算</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;存款利息：&quot;</span> <span class="token operator">+</span> accrual<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>程序运行结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>存款利息：760.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/27/2022, 2:55:59 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/design-pattern/设计模式/36-备忘录模式.html" class="prev">
        备忘录模式
      </a></span> <span class="next"><a href="/design-pattern/设计模式/38-行为型模式应用实验.html">
        行为型模式应用实验
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/design-pattern/assets/js/app.45f4ed8b.js" defer></script><script src="/design-pattern/assets/js/2.dd66b6b4.js" defer></script><script src="/design-pattern/assets/js/29.89b373e8.js" defer></script>
  </body>
</html>
