<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>状态模式 | JAVA设计模式</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="JAVA设计模式">
    
    <link rel="preload" href="/design-pattern/assets/css/0.styles.5341db10.css" as="style"><link rel="preload" href="/design-pattern/assets/js/app.45f4ed8b.js" as="script"><link rel="preload" href="/design-pattern/assets/js/2.dd66b6b4.js" as="script"><link rel="preload" href="/design-pattern/assets/js/12.5deb2685.js" as="script"><link rel="prefetch" href="/design-pattern/assets/js/10.e7bcc2af.js"><link rel="prefetch" href="/design-pattern/assets/js/11.a7e17509.js"><link rel="prefetch" href="/design-pattern/assets/js/13.8387bba7.js"><link rel="prefetch" href="/design-pattern/assets/js/14.6c42d1b1.js"><link rel="prefetch" href="/design-pattern/assets/js/15.3cb5bbbe.js"><link rel="prefetch" href="/design-pattern/assets/js/16.e60f62c7.js"><link rel="prefetch" href="/design-pattern/assets/js/17.f4ca0f28.js"><link rel="prefetch" href="/design-pattern/assets/js/18.be2874bb.js"><link rel="prefetch" href="/design-pattern/assets/js/19.98f55331.js"><link rel="prefetch" href="/design-pattern/assets/js/20.693bdd6c.js"><link rel="prefetch" href="/design-pattern/assets/js/21.cd7cac49.js"><link rel="prefetch" href="/design-pattern/assets/js/22.afafc6f9.js"><link rel="prefetch" href="/design-pattern/assets/js/23.f5f36a02.js"><link rel="prefetch" href="/design-pattern/assets/js/24.2761ed7d.js"><link rel="prefetch" href="/design-pattern/assets/js/25.73a46f0c.js"><link rel="prefetch" href="/design-pattern/assets/js/26.6afae513.js"><link rel="prefetch" href="/design-pattern/assets/js/27.9e44b99e.js"><link rel="prefetch" href="/design-pattern/assets/js/28.888ee2c2.js"><link rel="prefetch" href="/design-pattern/assets/js/29.89b373e8.js"><link rel="prefetch" href="/design-pattern/assets/js/3.704ac8ee.js"><link rel="prefetch" href="/design-pattern/assets/js/30.c1e53709.js"><link rel="prefetch" href="/design-pattern/assets/js/31.a53c8f9e.js"><link rel="prefetch" href="/design-pattern/assets/js/32.cd9a54d0.js"><link rel="prefetch" href="/design-pattern/assets/js/33.3efcfa5b.js"><link rel="prefetch" href="/design-pattern/assets/js/34.5bad324b.js"><link rel="prefetch" href="/design-pattern/assets/js/35.2f4dac27.js"><link rel="prefetch" href="/design-pattern/assets/js/36.06a6c412.js"><link rel="prefetch" href="/design-pattern/assets/js/37.139a7bc2.js"><link rel="prefetch" href="/design-pattern/assets/js/38.349560b7.js"><link rel="prefetch" href="/design-pattern/assets/js/39.1462d1dd.js"><link rel="prefetch" href="/design-pattern/assets/js/4.81f7c0d7.js"><link rel="prefetch" href="/design-pattern/assets/js/40.cc7739ed.js"><link rel="prefetch" href="/design-pattern/assets/js/41.30b4b76c.js"><link rel="prefetch" href="/design-pattern/assets/js/42.d4f9a883.js"><link rel="prefetch" href="/design-pattern/assets/js/43.3c75efc8.js"><link rel="prefetch" href="/design-pattern/assets/js/44.254cfecb.js"><link rel="prefetch" href="/design-pattern/assets/js/45.f970681e.js"><link rel="prefetch" href="/design-pattern/assets/js/46.2b6dc672.js"><link rel="prefetch" href="/design-pattern/assets/js/47.51bcccb8.js"><link rel="prefetch" href="/design-pattern/assets/js/48.a9a64665.js"><link rel="prefetch" href="/design-pattern/assets/js/49.56e52fda.js"><link rel="prefetch" href="/design-pattern/assets/js/5.d43c6033.js"><link rel="prefetch" href="/design-pattern/assets/js/50.024ee7ff.js"><link rel="prefetch" href="/design-pattern/assets/js/51.e23e7e1b.js"><link rel="prefetch" href="/design-pattern/assets/js/52.ddc4950d.js"><link rel="prefetch" href="/design-pattern/assets/js/53.56beec5d.js"><link rel="prefetch" href="/design-pattern/assets/js/54.cbec228c.js"><link rel="prefetch" href="/design-pattern/assets/js/6.686b6a92.js"><link rel="prefetch" href="/design-pattern/assets/js/7.1103645d.js"><link rel="prefetch" href="/design-pattern/assets/js/8.4dcd5424.js"><link rel="prefetch" href="/design-pattern/assets/js/9.01bd6308.js">
    <link rel="stylesheet" href="/design-pattern/assets/css/0.styles.5341db10.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/design-pattern/" class="home-link router-link-active"><!----> <span class="site-name">JAVA设计模式</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/design-pattern/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/senjyouhara/design-pattern" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/design-pattern/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://github.com/senjyouhara/design-pattern" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>设计模式</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/design-pattern/设计模式/0.0-概述.html" class="sidebar-link">软件设计模式概述</a></li><li><a href="/design-pattern/设计模式/0.1-GoF 的 23 种设计模式的分类和功能.html" class="sidebar-link">GoF 的 23 种设计模式的分类和功能</a></li><li><a href="/design-pattern/设计模式/0.2-UML统一建模语言是什么？.html" class="sidebar-link">UML统一建模语言是什么？</a></li><li><a href="/design-pattern/设计模式/0.3-UML类图及类图之间的关系.html" class="sidebar-link">UML类图及类图之间的关系</a></li><li><a href="/design-pattern/设计模式/0.4-类关系记忆技巧.html" class="sidebar-link">类关系记忆技巧</a></li><li><a href="/design-pattern/设计模式/0.5-UMLet的使用与类图的设计.html" class="sidebar-link">UMLet的使用与类图的设计</a></li><li><a href="/design-pattern/设计模式/0.6-什么才是优秀的软件架构？.html" class="sidebar-link">什么才是优秀的软件架构？</a></li><li><a href="/design-pattern/设计模式/0.7-如何正确使用设计模式？.html" class="sidebar-link">如何正确使用设计模式？</a></li><li><a href="/design-pattern/设计模式/01-开闭原则——面向对象设计原则.html" class="sidebar-link">开闭原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/02-里氏替换原则——面向对象设计原则.html" class="sidebar-link">里氏替换原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/03-依赖倒置原则——面向对象设计原则.html" class="sidebar-link">依赖倒置原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/04-单一职责原则——面向对象设计原则.html" class="sidebar-link">单一职责原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/05-接口隔离原则——面向对象设计原则.html" class="sidebar-link">接口隔离原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/06-迪米特法则——面向对象设计原则.html" class="sidebar-link">迪米特法则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/07-合成复用原则——面向对象设计原则.html" class="sidebar-link">合成复用原则——面向对象设计原则</a></li><li><a href="/design-pattern/设计模式/08-一句话总结软件设计七大原则.html" class="sidebar-link">一句话总结软件设计七大原则</a></li><li><a href="/design-pattern/设计模式/09-创建型模式的特点和分类.html" class="sidebar-link">创建型模式的特点和分类</a></li><li><a href="/design-pattern/设计模式/10-单例模式.html" class="sidebar-link">单例模式</a></li><li><a href="/design-pattern/设计模式/11-原型模式.html" class="sidebar-link">原型模式</a></li><li><a href="/design-pattern/设计模式/12-简单工厂模式.html" class="sidebar-link">简单工厂模式</a></li><li><a href="/design-pattern/设计模式/13-工厂方法模式.html" class="sidebar-link">工厂方法模式</a></li><li><a href="/design-pattern/设计模式/14-抽象工厂模式.html" class="sidebar-link">抽象工厂模式</a></li><li><a href="/design-pattern/设计模式/15-建造者模式.html" class="sidebar-link">建造者模式</a></li><li><a href="/design-pattern/设计模式/16-创建型模式应用实验.html" class="sidebar-link">创建型模式应用实验</a></li><li><a href="/design-pattern/设计模式/17-结构型模式概述.html" class="sidebar-link">结构型模式概述</a></li><li><a href="/design-pattern/设计模式/18-代理模式.html" class="sidebar-link">代理模式</a></li><li><a href="/design-pattern/设计模式/19-适配器模式.html" class="sidebar-link">适配器模式</a></li><li><a href="/design-pattern/设计模式/20-桥接模式.html" class="sidebar-link">桥接模式</a></li><li><a href="/design-pattern/设计模式/21-装饰器模式.html" class="sidebar-link">装饰器模式</a></li><li><a href="/design-pattern/设计模式/22-外观模式.html" class="sidebar-link">外观模式</a></li><li><a href="/design-pattern/设计模式/23-享元模式.html" class="sidebar-link">享元模式</a></li><li><a href="/design-pattern/设计模式/24-组合模式.html" class="sidebar-link">组合模式</a></li><li><a href="/design-pattern/设计模式/25-结构型模式应用实验.html" class="sidebar-link">结构型模式应用实验</a></li><li><a href="/design-pattern/设计模式/26-行为型模式概述.html" class="sidebar-link">行为型模式概述</a></li><li><a href="/design-pattern/设计模式/27-模板方法模式.html" class="sidebar-link">模板方法模式</a></li><li><a href="/design-pattern/设计模式/28-策略模式.html" class="sidebar-link">策略模式</a></li><li><a href="/design-pattern/设计模式/29-命令模式.html" class="sidebar-link">命令模式</a></li><li><a href="/design-pattern/设计模式/30-责任链模式.html" class="sidebar-link">责任链模式</a></li><li><a href="/design-pattern/设计模式/31-状态模式.html" class="active sidebar-link">状态模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design-pattern/设计模式/31-状态模式.html#状态模式" class="sidebar-link">状态模式</a></li></ul></li><li><a href="/design-pattern/设计模式/32-观察者模式.html" class="sidebar-link">观察者模式</a></li><li><a href="/design-pattern/设计模式/33-中介者模式.html" class="sidebar-link">中介者模式</a></li><li><a href="/design-pattern/设计模式/34-迭代器模式.html" class="sidebar-link">迭代器模式</a></li><li><a href="/design-pattern/设计模式/35-访问者模式.html" class="sidebar-link">访问者模式</a></li><li><a href="/design-pattern/设计模式/36-备忘录模式.html" class="sidebar-link">备忘录模式</a></li><li><a href="/design-pattern/设计模式/37-解释器模式.html" class="sidebar-link">解释器模式</a></li><li><a href="/design-pattern/设计模式/38-行为型模式应用实验.html" class="sidebar-link">行为型模式应用实验</a></li><li><a href="/design-pattern/设计模式/39-一句话归纳设计模式.html" class="sidebar-link">一句话归纳设计模式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="状态模式"><a href="#状态模式" class="header-anchor">#</a> 状态模式</h2> <p>在软件开发过程中，应用程序中的部分对象可能会根据不同的情况做出不同的行为，我们把这种对象称为有状态的对象，而把影响对象行为的一个或多个动态变化的属性称为状态。当有状态的对象与外部事件产生互动时，其内部状态就会发生改变，从而使其行为也发生改变。如人都有高兴和伤心的时候，不同的情绪有不同的行为，当然外界也会影响其情绪变化。</p> <p>对这种有状态的对象编程，传统的解决方案是：将这些所有可能发生的情况全都考虑到，然后使用 if-else 或 switch-case 语句来做状态判断，再进行不同情况的处理。但是显然这种做法对复杂的状态判断存在天然弊端，条件判断语句会过于臃肿，可读性差，且不具备扩展性，维护难度也大。且增加新的状态时要添加新的 if-else 语句，这违背了“开闭原则”，不利于程序的扩展。</p> <p>以上问题如果采用“状态模式”就能很好地得到解决。状态模式的解决思想是：当控制一个对象状态转换的条件表达式过于复杂时，把相关“判断逻辑”提取出来，用各个不同的类进行表示，系统处于哪种情况，直接使用相应的状态类对象进行处理，这样能把原来复杂的逻辑判断简单化，消除了 if-else、switch-case 等冗余语句，代码更有层次性，并且具备良好的扩展力。</p> <h3 id="状态模式的定义与特点"><a href="#状态模式的定义与特点" class="header-anchor">#</a> 状态模式的定义与特点</h3> <p>状态（State）模式的定义：对有状态的对象，把复杂的“判断逻辑”提取到不同的状态对象中，允许状态对象在其内部状态发生改变时改变其行为。</p> <p>状态模式是一种对象行为型模式，其主要优点如下。</p> <ul><li>结构清晰，状态模式将与特定状态相关的行为局部化到一个状态中，并且将不同状态的行为分割开来，满足“单一职责原则”。</li> <li>将状态转换显示化，减少对象间的相互依赖。将不同的状态引入独立的对象中会使得状态转换变得更加明确，且减少对象间的相互依赖。</li> <li>状态类职责明确，有利于程序的扩展。通过定义新的子类很容易地增加新的状态和转换。</li></ul> <p>状态模式的主要缺点如下。</p> <ul><li>状态模式的使用必然会增加系统的类与对象的个数。</li> <li>状态模式的结构与实现都较为复杂，如果使用不当会导致程序结构和代码的混乱。</li> <li>状态模式对开闭原则的支持并不太好，对于可以切换状态的状态模式，增加新的状态类需要修改那些负责状态转换的源码，否则无法切换到新增状态，而且修改某个状态类的行为也需要修改对应类的源码。</li></ul> <h3 id="状态模式的结构与实现"><a href="#状态模式的结构与实现" class="header-anchor">#</a> 状态模式的结构与实现</h3> <p>状态模式把受环境改变的对象行为包装在不同的状态对象里，其意图是让一个对象在其内部状态改变的时候，其行为也随之改变。现在我们来分析其基本结构和实现方法。</p> <h5 id="_1-模式的结构"><a href="#_1-模式的结构" class="header-anchor">#</a> 1. 模式的结构</h5> <p>状态模式包含以下主要角色。</p> <ul><li>环境类（Context）角色：也称为上下文，它定义了客户端需要的接口，内部维护一个当前状态，并负责具体状态的切换。</li> <li>抽象状态（State）角色：定义一个接口，用以封装环境对象中的特定状态所对应的行为，可以有一个或多个行为。</li> <li>具体状态（Concrete State）角色：实现抽象状态所对应的行为，并且在需要的情况下进行状态切换。</li></ul> <p>其结构图如图所示。</p> <p><img src="/design-pattern/assets/img/3-1Q11615412U55.9b1dd329.gif" alt=""></p> <h5 id="_2-模式的实现"><a href="#_2-模式的实现" class="header-anchor">#</a> 2. 模式的实现</h5> <p>状态模式的实现代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StatePatternClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//创建环境      </span>
        <span class="token class-name"><span class="token namespace">context<span class="token punctuation">.</span></span>Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//处理请求</span>
        <span class="token class-name"><span class="token namespace">context<span class="token punctuation">.</span></span>Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">context<span class="token punctuation">.</span></span>Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">context<span class="token punctuation">.</span></span>Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//环境类</span>
<span class="token keyword">class</span> <span class="token class-name">Context</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">State</span> state<span class="token punctuation">;</span>
    <span class="token comment">//定义环境类的初始状态</span>
    <span class="token keyword">public</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteStateA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//设置新状态</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">State</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//读取状态</span>
    <span class="token keyword">public</span> <span class="token class-name">State</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//对请求做处理</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token namespace">state<span class="token punctuation">.</span></span>Handle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//抽象状态类</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token class-name">Handle</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态A类</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteStateA</span> <span class="token keyword">extends</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Handle</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前状态是 A.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteStateB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态B类</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteStateB</span> <span class="token keyword">extends</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Handle</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前状态是 B.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteStateA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>程序运行结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>当前状态是 A.
当前状态是 B.
当前状态是 A.
当前状态是 B.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="状态模式的应用实例"><a href="#状态模式的应用实例" class="header-anchor">#</a> 状态模式的应用实例</h3> <p>【例1】用“状态模式”设计一个学生成绩的状态转换程序。</p> <p>分析：本实例包含了“不及格”“中等”和“优秀” 3 种状态，当学生的分数小于 60 分时为“不及格”状态，当分数大于等于 60 分且小于 90 分时为“中等”状态，当分数大于等于 90 分时为“优秀”状态，我们用状态模式来实现这个程序。</p> <p>首先，定义一个抽象状态类（AbstractState），其中包含了环境属性、状态名属性和当前分数属性，以及加减分方法 addScore(intx) 和检查当前状态的抽象方法 checkState()。</p> <p>然后，定义“不及格”状态类 LowState、“中等”状态类 MiddleState 和“优秀”状态类 HighState，它们是具体状态类，实现 checkState() 方法，负责检査自己的状态，并根据情况转换。</p> <p>最后，定义环境类（ScoreContext），其中包含了当前状态对象和加减分的方法 add(int score)，客户类通过该方法来改变成绩状态。图 2 所示是其结构图。</p> <p><img src="/design-pattern/assets/img/3-1Q11615425V39.1895d6fa.gif" alt=""></p> <p>程序代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScoreStateTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ScoreContext</span> account <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScoreContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;学生成绩状态测试：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//环境类</span>
<span class="token keyword">class</span> <span class="token class-name">ScoreContext</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">AbstractState</span> state<span class="token punctuation">;</span>
    <span class="token class-name">ScoreContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LowState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">AbstractState</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">AbstractState</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> score<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span><span class="token function">addScore</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//抽象状态类</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractState</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">ScoreContext</span> hj<span class="token punctuation">;</span>  <span class="token comment">//环境</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> stateName<span class="token punctuation">;</span> <span class="token comment">//状态名</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> score<span class="token punctuation">;</span> <span class="token comment">//分数</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">checkState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//检查当前状态</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addScore</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        score <span class="token operator">+=</span> x<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;加上：&quot;</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">&quot;分，\t当前分数：&quot;</span> <span class="token operator">+</span> score<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">checkState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;分，\t当前状态：&quot;</span> <span class="token operator">+</span> hj<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stateName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态类：不及格</span>
<span class="token keyword">class</span> <span class="token class-name">LowState</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">LowState</span><span class="token punctuation">(</span><span class="token class-name">ScoreContext</span> h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hj <span class="token operator">=</span> h<span class="token punctuation">;</span>
        stateName <span class="token operator">=</span> <span class="token string">&quot;不及格&quot;</span><span class="token punctuation">;</span>
        score <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">LowState</span><span class="token punctuation">(</span><span class="token class-name">AbstractState</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hj <span class="token operator">=</span> state<span class="token punctuation">.</span>hj<span class="token punctuation">;</span>
        stateName <span class="token operator">=</span> <span class="token string">&quot;不及格&quot;</span><span class="token punctuation">;</span>
        score <span class="token operator">=</span> state<span class="token punctuation">.</span>score<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">&gt;=</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HighState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">&gt;=</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MiddleState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态类：中等</span>
<span class="token keyword">class</span> <span class="token class-name">MiddleState</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">MiddleState</span><span class="token punctuation">(</span><span class="token class-name">AbstractState</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hj <span class="token operator">=</span> state<span class="token punctuation">.</span>hj<span class="token punctuation">;</span>
        stateName <span class="token operator">=</span> <span class="token string">&quot;中等&quot;</span><span class="token punctuation">;</span>
        score <span class="token operator">=</span> state<span class="token punctuation">.</span>score<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LowState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">&gt;=</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HighState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态类：优秀</span>
<span class="token keyword">class</span> <span class="token class-name">HighState</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">HighState</span><span class="token punctuation">(</span><span class="token class-name">AbstractState</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        hj <span class="token operator">=</span> state<span class="token punctuation">.</span>hj<span class="token punctuation">;</span>
        stateName <span class="token operator">=</span> <span class="token string">&quot;优秀&quot;</span><span class="token punctuation">;</span>
        score <span class="token operator">=</span> state<span class="token punctuation">.</span>score<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LowState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">&lt;</span> <span class="token number">90</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MiddleState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><p>程序运行结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>学生成绩状态测试：
加上：30分，    当前分数：30分，    当前状态：不及格
加上：40分，    当前分数：70分，    当前状态：中等
加上：25分，    当前分数：95分，    当前状态：优秀
加上：-15分，    当前分数：80分，    当前状态：中等
加上：-25分，    当前分数：55分，    当前状态：不及格
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>【例2】用“状态模式”设计一个多线程的状态转换程序。</p> <p>分析：多线程存在 5 种状态，分别为新建状态、就绪状态、运行状态、阻塞状态和死亡状态，各个状态当遇到相关方法调用或事件触发时会转换到其他状态，其状态转换规律如图所示。</p> <p><img src="data:image/gif;base64,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" alt=""></p> <p>现在先定义一个抽象状态类（TheadState），然后为图 3 所示的每个状态设计一个具体状态类，它们是新建状态（New）、就绪状态（Runnable ）、运行状态（Running）、阻塞状态（Blocked）和死亡状态（Dead），每个状态中有触发它们转变状态的方法，环境类（ThreadContext）中先生成一个初始状态（New），并提供相关触发方法，图 4 所示是线程状态转换程序的结构图。</p> <p><img src="/design-pattern/assets/img/3-1Q116154432352.281074c8.gif" alt=""></p> <p>程序代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScoreStateTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">getCPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">getCPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//环境类</span>
<span class="token keyword">class</span> <span class="token class-name">ThreadContext</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">ThreadState</span> state<span class="token punctuation">;</span>
    <span class="token class-name">ThreadContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">ThreadState</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">ThreadState</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">New</span><span class="token punctuation">)</span> state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getCPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span><span class="token punctuation">)</span> state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCPU</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Running</span><span class="token punctuation">)</span> state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">suspend</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Running</span><span class="token punctuation">)</span> state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Blocked</span><span class="token punctuation">)</span> state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//抽象状态类：线程状态</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ThreadState</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> stateName<span class="token punctuation">;</span> <span class="token comment">//状态名</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态类：新建状态</span>
<span class="token keyword">class</span> <span class="token class-name">New</span> <span class="token keyword">extends</span> <span class="token class-name">ThreadState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stateName <span class="token operator">=</span> <span class="token string">&quot;新建状态&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程处于：新建状态.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">ThreadContext</span> hj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;调用start()方法--&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stateName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;新建状态&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程不是新建状态，不能调用start()方法.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态类：就绪状态</span>
<span class="token keyword">class</span> <span class="token class-name">Runnable</span> <span class="token keyword">extends</span> <span class="token class-name">ThreadState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stateName <span class="token operator">=</span> <span class="token string">&quot;就绪状态&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程处于：就绪状态.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getCPU</span><span class="token punctuation">(</span><span class="token class-name">ThreadContext</span> hj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;获得CPU时间--&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stateName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;就绪状态&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Running</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程不是就绪状态，不能获取CPU.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态类：运行状态</span>
<span class="token keyword">class</span> <span class="token class-name">Running</span> <span class="token keyword">extends</span> <span class="token class-name">ThreadState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Running</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stateName <span class="token operator">=</span> <span class="token string">&quot;运行状态&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程处于：运行状态.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">suspend</span><span class="token punctuation">(</span><span class="token class-name">ThreadContext</span> hj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;调用suspend()方法--&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stateName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;运行状态&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程不是运行状态，不能调用suspend()方法.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token class-name">ThreadContext</span> hj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;调用stop()方法--&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stateName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;运行状态&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程不是运行状态，不能调用stop()方法.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态类：阻塞状态</span>
<span class="token keyword">class</span> <span class="token class-name">Blocked</span> <span class="token keyword">extends</span> <span class="token class-name">ThreadState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Blocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stateName <span class="token operator">=</span> <span class="token string">&quot;阻塞状态&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程处于：阻塞状态.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resume</span><span class="token punctuation">(</span><span class="token class-name">ThreadContext</span> hj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;调用resume()方法--&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stateName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;阻塞状态&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            hj<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程不是阻塞状态，不能调用resume()方法.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态类：死亡状态</span>
<span class="token keyword">class</span> <span class="token class-name">Dead</span> <span class="token keyword">extends</span> <span class="token class-name">ThreadState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Dead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stateName <span class="token operator">=</span> <span class="token string">&quot;死亡状态&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前线程处于：死亡状态.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br></div></div><p>程序运行结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>当前线程处于：新建状态.
调用start()方法--&gt;当前线程处于：就绪状态.
获得CPU时间--&gt;当前线程处于：运行状态.
调用suspend()方法--&gt;当前线程处于：阻塞状态.
调用resume()方法--&gt;当前线程处于：就绪状态.
获得CPU时间--&gt;当前线程处于：运行状态.
调用stop()方法--&gt;当前线程处于：死亡状态.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="状态模式的应用场景"><a href="#状态模式的应用场景" class="header-anchor">#</a> 状态模式的应用场景</h3> <p>通常在以下情况下可以考虑使用状态模式。</p> <ul><li>当一个对象的行为取决于它的状态，并且它必须在运行时根据状态改变它的行为时，就可以考虑使用状态模式。</li> <li>一个操作中含有庞大的分支结构，并且这些分支决定于对象的状态时。</li></ul> <h3 id="状态模式的扩展"><a href="#状态模式的扩展" class="header-anchor">#</a> 状态模式的扩展</h3> <p>在有些情况下，可能有多个环境对象需要共享一组状态，这时需要引入享元模式，将这些具体状态对象放在集合中供程序共享，其结构图如图所示。</p> <p><img src="/design-pattern/assets/img/3-1Q116154539147.c02fd9a5.gif" alt=""></p> <p>分析：共享状态模式的不同之处是在环境类中增加了一个 HashMap 来保存相关状态，当需要某种状态时可以从中获取，其程序代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">state</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlyweightStatePattern</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ShareContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShareContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建环境      </span>
        <span class="token class-name"><span class="token namespace">context<span class="token punctuation">.</span></span>Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//处理请求</span>
        <span class="token class-name"><span class="token namespace">context<span class="token punctuation">.</span></span>Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">context<span class="token punctuation">.</span></span>Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">context<span class="token punctuation">.</span></span>Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//环境类</span>
<span class="token keyword">class</span> <span class="token class-name">ShareContext</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">ShareState</span> state<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ShareState</span><span class="token punctuation">&gt;</span></span> stateSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ShareState</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">ShareContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteState1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stateSet<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteState2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stateSet<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        state <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//设置新状态</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">ShareState</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//读取状态</span>
    <span class="token keyword">public</span> <span class="token class-name">ShareState</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ShareState</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ShareState</span><span class="token punctuation">)</span> stateSet<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//对请求做处理</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token namespace">state<span class="token punctuation">.</span></span>Handle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//抽象状态类</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ShareState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token class-name">Handle</span><span class="token punctuation">(</span><span class="token class-name">ShareContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态1类</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteState1</span> <span class="token keyword">extends</span> <span class="token class-name">ShareState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Handle</span><span class="token punctuation">(</span><span class="token class-name">ShareContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前状态是： 状态1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//具体状态2类</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteState2</span> <span class="token keyword">extends</span> <span class="token class-name">ShareState</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Handle</span><span class="token punctuation">(</span><span class="token class-name">ShareContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前状态是： 状态2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>程序运行结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>当前状态是： 状态1
当前状态是： 状态2
当前状态是： 状态1
当前状态是： 状态2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="拓展"><a href="#拓展" class="header-anchor">#</a> 拓展</h3> <h5 id="状态模式与责任链模式的区别"><a href="#状态模式与责任链模式的区别" class="header-anchor">#</a> 状态模式与责任链模式的区别</h5> <p>状态模式和责任链模式都能消除 if-else 分支过多的问题。但在某些情况下，状态模式中的状态可以理解为责任，那么在这种情况下，两种模式都可以使用。</p> <p>从定义来看，状态模式强调的是一个对象内在状态的改变，而责任链模式强调的是外部节点对象间的改变。</p> <p>从代码实现上来看，两者最大的区别就是状态模式的各个状态对象知道自己要进入的下一个状态对象，而责任链模式并不清楚其下一个节点处理对象，因为链式组装由客户端负责。</p> <h5 id="状态模式与策略模式的区别"><a href="#状态模式与策略模式的区别" class="header-anchor">#</a> 状态模式与策略模式的区别</h5> <p>状态模式和策略模式的 UML 类图架构几乎完全一样，但两者的应用场景是不一样的。策略模式的多种算法行为择其一都能满足，彼此之间是独立的，用户可自行更换策略算法，而状态模式的各个状态间存在相互关系，彼此之间在一定条件下存在自动切换状态的效果，并且用户无法指定状态，只能设置初始状态。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/27/2022, 2:55:59 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/design-pattern/设计模式/30-责任链模式.html" class="prev">
        责任链模式
      </a></span> <span class="next"><a href="/design-pattern/设计模式/32-观察者模式.html">
        观察者模式
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/design-pattern/assets/js/app.45f4ed8b.js" defer></script><script src="/design-pattern/assets/js/2.dd66b6b4.js" defer></script><script src="/design-pattern/assets/js/12.5deb2685.js" defer></script>
  </body>
</html>
